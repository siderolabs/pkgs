name: eudev
variant: scratch
shell: /toolchain/bin/bash
dependencies:
  - stage: base
  - stage: musl
steps:
  - sources:
      - url: https://dev.gentoo.org/~blueness/eudev/eudev-3.2.8.tar.gz
        destination: eudev.tar.gz
        sha256: 61e4948e9e51271c3cce2bb5311a30b206dd03ef011062e6c627fb007e43f6b8
        sha512: 13221e6f9696a8630d867eb7d73f3bf5dd1bc2dfd80d62af00342be4cbf39a862e644ea3776fa4d91463e594ca50c5deecbeb7e05d161097e889ea58a66ccc42
    prepare:
      - |
        tar -xzf eudev.tar.gz --strip-components=1

        # Required by gperf.
        cp /toolchain/lib/libstdc++* /lib

        cat > config.cache << "EOF"
        HAVE_BLKID=1
        BLKID_LIBS="-lblkid"
        BLKID_CFLAGS="-I${TOOLCHAIN}/include"
        EOF

        mkdir build
        cd build

        ../configure \
          --prefix=/usr \
          --libexecdir=/usr/libexec \
          --sbindir=/sbin \
          --disable-manpages \
          --enable-hwdb \
          --disable-static
    build:
      - |
        cd build
        make -j $(nproc)
    install:
      - |
        cd build
        make install DESTDIR=/rootfs
finalize:
  - from: /rootfs
    to: /
