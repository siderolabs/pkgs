name: xfsprogs
variant: scratch
shell: /toolchain/bin/bash
dependencies:
- stage: base
- stage: musl
- stage: ca-certificates
steps:
- sources:
  - url: https://www.kernel.org/pub/linux/utils/fs/xfs/xfsprogs/xfsprogs-4.18.0.tar.xz
    destination: xfsprogs.tar.xz
    sha256: 397dc96f51aeeff73d021d3418d3172377b2685f2740ca60525096c070aa3df1
    sha512: 0629400f8824620138928a7d72908b7a852408814238a55e11d6eb3b2da42cd56273960430d3ea729a9bce95f605d225607940d4728b68c468c39eb5a9a590be
  prepare:
  - |
    tar -xJf xfsprogs.tar.xz --strip-components=1

    mkdir /bin
    ln -sv /toolchain/bin/bash /bin/bash
    ln -sv /toolchain/bin/bash /bin/sh
    cp -R /toolchain/lib/gcc /lib
    cp -R /toolchain/lib/libgcc* /lib

    # TODO(andrewrynhard): Add a util-linux package in this repo and pull these from there.
    cp /toolchain/lib/libuuid* /lib
    cp /toolchain/lib/libblkid* /lib

    ./configure \
    --prefix=/ \
    --enable-gettext=no
  build:
  - |
    make -j $(nproc) DEBUG=-DNDEBUG
  install:
  - |
    make install DESTDIR=/rootfs
finalize:
- from: /rootfs
  to: /
