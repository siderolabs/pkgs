name: kubeadm
finalize:
  - from: /rootfs
    to: /
steps:
  - sources:
      - url: https://storage.googleapis.com/kubernetes-release/release/v1.16.0-alpha.3/bin/linux/amd64/kubeadm
        destination: kubeadm-linux-amd64
        sha256: 1a5d059a3b4db46d8f5ba69dc4d0f2582e9acf68324c9246712bd318120528ab
        sha512: 7721a1a123383f89d905344a167ba3b59d8e7030168997cf2001294190e3c82d631281afd27fc2d5aeb7629592a96fa84150db78edc5b77e89da554c02e6a4d7
      - url: https://storage.googleapis.com/kubernetes-release/release/v1.16.0-alpha.3/bin/linux/arm64/kubeadm
        destination: kubeadm-linux-arm64
        sha256: b7eb0a337ef74fb727cba861a27264a6e3c9800f40c5467aa0058e60d5aec3a0
        sha512: ac9c112917c3ad281713867ca9cdce80418c40aab8ba9b7bd382559003804468411f8bf08338cafad95114d5c651208f9da87f04e4c82653b6a1da4a906c5714

    install: |
      mkdir -p /rootfs/bin

      case $ARCH in
          x86_64)
              cp kubeadm-linux-amd64 /rootfs/bin/kubeadm
          ;;
          aarch64)
              cp kubeadm-linux-arm64 /rootfs/bin/kubeadm
          ;;
          *)
              echo "unsupported arch ${ARCH}"
              exit 1
          ;;
      esac

      chmod +x /rootfs/bin/kubeadm
