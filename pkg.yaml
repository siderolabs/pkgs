name: kubeadm
finalize:
  - from: /rootfs
    to: /
steps:
  - sources:
      - url: https://storage.googleapis.com/kubernetes-release/release/v1.16.0-beta.2/bin/linux/amd64/kubeadm
        destination: kubeadm-linux-amd64
        sha256: bba224360cfb4e6471f84523fcc954951c05c0fef0a4311a07e76f306cadebf1
        sha512: 5e848d0c8fe84acf730d2a0e6fc39cf5637ee30e0dcacc78f267e86d7e6a3c53e363c8c12ec6b946695c6bacea526cdd2c8b5cb74b6b6337c77ba4b6b712940b
      - url: https://storage.googleapis.com/kubernetes-release/release/v1.16.0-beta.2/bin/linux/arm64/kubeadm
        destination: kubeadm-linux-arm64
        sha256: 0e3ae66f2f57a18eb363af1d49a22b35a24e32bf36af5ef630aa5ceeedc9feed
        sha512: 444fa83896910d3c1c8907b8ce65fe8b58dbc0f90c03cf9a59753d57ff1ab9cfd535d2cf74a0704c02c3348a5b78c16a3e0667cd7e90680d5012546814a7e600

    install: |
      mkdir -p /rootfs/bin

      case $ARCH in
          x86_64)
              cp kubeadm-linux-amd64 /rootfs/bin/kubeadm
          ;;
          aarch64)
              cp kubeadm-linux-arm64 /rootfs/bin/kubeadm
          ;;
          *)
              echo "unsupported arch ${ARCH}"
              exit 1
          ;;
      esac

      chmod +x /rootfs/bin/kubeadm
