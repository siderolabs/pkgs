name: kubeadm
finalize:
  - from: /rootfs
    to: /
steps:
  - sources:
      - url: https://storage.googleapis.com/kubernetes-release/release/v1.16.0-rc.2/bin/linux/amd64/kubeadm
        destination: kubeadm-linux-amd64
        sha256: 8c929a5cc4e4162959fb388325e291d09659ed6215c52047a0c40cf863901e11
        sha512: c93ec703043ca3129edfa7244a409e4bfbc25a697a0737cf02267633c391c281499c7c2d218c0e7c409a258a699e8baf4063bc36bd82feb85103277085ac0dd9
      - url: https://storage.googleapis.com/kubernetes-release/release/v1.16.0-rc.2/bin/linux/arm64/kubeadm
        destination: kubeadm-linux-arm64
        sha256: 9465c25bcdbe750e7d669739888c09146c8f68e1cbcceca92391eaa9ba054c6a
        sha512: 188da9580937638b2573836d52a1e379b18cb2d238f35777e2a50ee90b6ea145d4ac1b7c780098737e103b67c1f5f7feb685b8133df977924a7427f7e1e6e0d7

    install: |
      mkdir -p /rootfs/bin

      case $ARCH in
          x86_64)
              cp kubeadm-linux-amd64 /rootfs/bin/kubeadm
          ;;
          aarch64)
              cp kubeadm-linux-arm64 /rootfs/bin/kubeadm
          ;;
          *)
              echo "unsupported arch ${ARCH}"
              exit 1
          ;;
      esac

      chmod +x /rootfs/bin/kubeadm
