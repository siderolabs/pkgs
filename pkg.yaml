name: kubeadm
finalize:
  - from: /rootfs
    to: /
steps:
  - sources:
      - url: https://storage.googleapis.com/kubernetes-release/release/v1.16.0-rc.1/bin/linux/amd64/kubeadm
        destination: kubeadm-linux-amd64
        sha256: 5a5e6d19d573ac783af06678b95299c05fc9d9a541071be87a30ef09f71d82a6
        sha512: 4e0e28ae4005d81ad90271a1ccea190fa7453ada73a8c8cd86b066afebeabeb797524db63095d71a0ef306d94c07b8bbcc78a8411cda7e0f0f23c13bc3ef038b
      - url: https://storage.googleapis.com/kubernetes-release/release/v1.16.0-rc.1/bin/linux/arm64/kubeadm
        destination: kubeadm-linux-arm64
        sha256: 2071f7b66f230b37aa72479f466fbbaf3867b8ed2c13e0c52f3cd871192b7f21
        sha512: f4484af9a1da7c9b1f127552f4cfae18e9813303242ac1ef50a7658af189935b670f8ac9085d044ab7be599253aa58bf8f0162c5e6958f548302ea649ec97508

    install: |
      mkdir -p /rootfs/bin

      case $ARCH in
          x86_64)
              cp kubeadm-linux-amd64 /rootfs/bin/kubeadm
          ;;
          aarch64)
              cp kubeadm-linux-arm64 /rootfs/bin/kubeadm
          ;;
          *)
              echo "unsupported arch ${ARCH}"
              exit 1
          ;;
      esac

      chmod +x /rootfs/bin/kubeadm
