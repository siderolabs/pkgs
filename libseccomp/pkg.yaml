name: libseccomp
variant: scratch
shell: /toolchain/bin/bash
dependencies:
  - stage: base
steps:
  - sources:
      - url: https://github.com/seccomp/libseccomp/releases/download/v2.4.1/libseccomp-2.4.1.tar.gz
        destination: libseccomp.tar.gz
        sha256: 1ca3735249af66a1b2f762fe6e710fcc294ad7185f1cc961e5bd83f9988006e8
        sha512: 1fe47ebb032635ba1b1cbefb505a0c103bae659844d1bf106d03e7f28b3c470726f7b0dbbe76d10ab89501630dc4f20b162c2eeefa22394eb632f803ae62ccc5
    prepare:
      - |
        tar -xzf libseccomp.tar.gz --strip-components=1

        mkdir build
        cd build

        ../configure \
            --prefix=/usr \
            --disable-static
    build:
      - |
        cd build
        make -j $(nproc)
    install:
      - |
        cd build
        make install DESTDIR=/rootfs
finalize:
  - from: /rootfs
    to: /
